
@{
    ViewBag.Title = "Stats";
}



<div class="container">
    <div class="row text-center">
        <h2>Stats</h2>
    </div>

    <hr />
    <div class="row">
        <div class="col-lg-12 text-center">
            <div id="piechart" style="width: 700px; height: 500px;"></div>
        </div>
    </div>
    <hr />
    <div class="row">
        <div class="col-lg-12">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th scope="col">Category</th>
                        <th scope="col">Avg. Time</th>
                        <th scope="col">Stats</th>
                    </tr>
                </thead>
                <tbody id="body">
                </tbody>
            </table>
        </div>
    </div>
</div>


<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    google.charts.load('current', { packages: ['corechart', 'line'] });
    google.charts.setOnLoadCallback(drawBasic);

    function drawBasic() {
        let url = 'http://localhost:58414'
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                // Typical action to be performed when the document is ready:
                var data = xhttp.responseText;
                drawFirst(data);
            }
        };
        xhttp.open("GET", url + '/api/stats', true);
        xhttp.send();
    }

    
    function drawFirst(data) {
        var arr = JSON.parse(data);
        for (let i = 0; i < arr.length; i++) {
            var body = document.getElementById("body");
            var row = body.insertRow(i);
            var parsedArr = arr[i];
            var graphData = parsedArr.activitiesDto;
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            cell1.innerHTML = parsedArr.catgoryName;
            cell2.innerHTML = parsedArr.averageTime;
            drawGraph(graphData, cell3);
        }
    }
    //drawFirst();
    function drawGraph(data, cell3) {
        console.log(data);
        var table = new google.visualization.DataTable();
        table.addColumn('string', 'Date');
        table.addColumn('number', 'Hours Spent');

        for (var i = 0; i < data.length; i++) {
            table.addRow([data[i].date.split("T00")[0], data[i].totalSpent]);
        }
        console.log(table);

        var options = {
            chartArea: { width: '75%' },
            hAxis: {
                title: 'Date',
                minValue: 0
            },
            vAxis: {
                title: 'Hours Spent'
            },
            seriesType: 'line',
            series: { 0: { type: 'line', lineWidth: 3 } },
            'width': 1000,
            'height': 200
        };

        var chart = new google.visualization.LineChart(cell3);

        chart.draw(table, options);
    }
</script>


<script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {

        var data = google.visualization.arrayToDataTable([
          ['Task', 'Hours per Day'],
          ['Relaxare',     52.60],
          ['Plimbare',      47.39],
        ]);

        var options = {
          title: 'My Daily Activities'
        };

        var chart = new google.visualization.PieChart(document.getElementById('piechart'));

        chart.draw(data, options);
      }
</script>